#server {
#  server_name _;
#  listen [::]:80;
#  listen 80;
#  rewrite_log off;
#  error_log off;
#  access_log off;
#  log_not_found off;
#  keepalive_timeout 0;
#  if ($bad_client) { return 403; }
#  if ($bad_asn) { return 403; }
#  if ($request_method !~ ^(GET)$ ){ return 403; }
#  if ($hostp = 0) { return 403; }
#
#  return 301 https://$http_host$request_uri;
#}

server {
  listen [::]:443 http2 ssl default_server;
  listen 443 http2 ssl;
  listen [::]:80;
  listen 80 default_server;

      
  server_name m2.com www.m2.com localhost decora.com _;

  #if ($bad_client) { return 403; }
  #if ($bad_asn) { return 403; }
  #if ($hostp = 0) { return 403; }


  ssl_certificate /etc/nginx/certs/m2.com.crt;
  ssl_certificate_key /etc/nginx/certs/m2.com_ecc.key;

  ssl_session_cache shared:SSL:20m;
  ssl_session_timeout 5m;
  ssl_protocols TLSv1.3 TLSv1.2 TLSv1.1 TLSv1;
  ssl_early_data on; #tls0
  ssl_session_tickets on;
  ssl_stapling off;
  ssl_stapling_verify off;
  ssl_buffer_size 8k;
  ssl_prefer_server_ciphers off;

  error_log /var/log/nginx/error_443.log;
  access_log /var/log/nginx/access_443.log json_combined if=$logable buffer=128k flush=10s;

    index index.php;  
    autoindex off;
    charset UTF-8;

    root /var/www/html/public;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {

  	try_files $uri =404;
		fastcgi_pass   app;
		fastcgi_buffers 16 16k;
		fastcgi_buffer_size 32k;
		fastcgi_param  PHP_FLAG  "session.auto_start=off \n suhosin.session.cryptua=off";
		fastcgi_param  PHP_VALUE "memory_limit=2048M \n max_execution_time=18000";
		fastcgi_read_timeout 900s;
		fastcgi_connect_timeout 900s;
		fastcgi_keep_conn off;
		fastcgi_index  index.php;
		#fastcgi_param  PHP_FLAG  "opcache.enable=0";
		fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
		include        fastcgi_params;
	}
}
